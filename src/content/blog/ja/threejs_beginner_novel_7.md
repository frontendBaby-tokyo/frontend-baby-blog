---
description: 連載「Three.js ってなんだろう？ カエル君と学ぶ、ブラウザ3Dの不思議な世界」
pubDate: 2025-08-08T05:00:00.000Z
recommended: false
tags:
  - tags.tech.threejs
  - tags.genre.tech-light-novel
title: 第7話 「最後の仕事人！ レンダラーの全てを暴け」 
---

## Three.js ってなんだろう？ カエル君と学ぶ、ブラウザ3Dの不思議な世界

### 注

この物語は、Three.jsを楽しく学ぶことを目的に、生成AIを活用して執筆されています。
技術的な情報の正確性には細心の注意を払っていますが、その内容がすべて真実であることを保証するものではありません。
あくまで学習の補助ツールとして、肩の力を抜いてお楽しみください。

---

### 登場人物紹介

*   **カエル君:** 最近プログラミングを学び始めた元気なカエル。まだ知らないことばかりだけど、好奇心は人一倍。「〜ケロ」という口調が特徴。
*   **三郎先生:** 3DグラフィックスやWeb技術にとても詳しい物知り博士。どんな質問にも優しく答えてくれる。

---

### 第7話：最後の仕事人！ レンダラーの全てを暴け

**カエル君:** 「先生！ シーン、カメラ、オブジェクト…これまでたくさんのことを学んできたんだケロ。でも、最後に残された最大の謎、それが `renderer.render(scene, camera)` の一行なんだケロ！ この『レンダラー』こそが、全てを画面に映し出す最後の仕事人…。こいつの正体を、今日は丸裸にしてやりたいんだケロ！」

**三郎先生:** 「はっはっは、カエル君、すごい意気込みだ。ついにラスボスに挑む気分だね。よろしい、今日はそのレンダラーの全てを語ろう。レンダラーは単なる『画家』ではない。シーン全体の『現場監督』であり、GPUに対する唯一の『司令官』なんだ。」

**カエル君:** 「司令官！ カッコいいんだケロ！ その司令官は、`render` 命令が出た後、一体どんな仕事をしているんだケロ？」

**三郎先生:** 「よし、司令官の仕事の流れを順に見ていこう。これは、CPU（頭脳）とGPU（超絶技巧の絵描き専門家）の壮大な共同作業だ。」

### レンダラーの処理フロー：壮大なるリレー

**三郎先生:** 「`renderer.render(scene, camera)` が呼ばれると、まずCPU側で周到な準備が始まる。」

**ステップ1：フラスタムカリング（Frustum Culling）**
「最初に、カメラの視界（視錐台）に全く入っていないオブジェクトを、描画対象からごっそり除外する。遠すぎて見えない、横すぎて見えない、そんなオブジェクトを計算するだけ無駄だからね。これが最初の選別作業だ。」

**カエル君:** 「なるほど！ 無駄な仕事はしない、効率的な司令官なんだケロね。」

**ステップ2：シーングラフ解析と行列計算**
「次に、描画対象に残ったオブジェクトたちの親子関係をたどり、それぞれの最終的なワールド座標を計算する。これは第四章、第五章で学んだ通りだね。」

**ステップ3：WebGL命令への大翻訳**
「ここが司令官の腕の見せ所だ。シーンという人間が理解しやすい情報を、GPUが唯一理解できるWebGLの言葉へと翻訳していくんだ。」
*   **ジオメトリ（形）** は → **頂点バッファ（座標の数字の羅列）** へ
*   **マテリアル（素材）** は → **シェーダー（ピクセルをどう塗るかの計算プログラム）** へ
*   **オブジェクトの位置や色、光源の情報** は → **ユニフォーム変数（シェーダーに渡す設定値）** へ

**カエル君:** 「うわー、ここで全部がバラバラの部品に翻訳されるんだケロ…。」

**ステップ4：GPUへの命令発行（ドローコール）**
「翻訳した部品をGPUに転送し、『この頂点データとこのシェーダーを使って、三角形を描け！』という命令を出す。この命令こそが**ドローコール（Draw Call）**だ。これがCPU側の最後の仕事になる。」

**ステップ5：GPUによる超並列計算**
「命令を受け取ったGPUは、その本領を発揮する。何千もの小さなプロセッサが、一斉に、並列で、頂点の位置を計算し、無数の三角形を作り、どのピクセルを何色で塗るかを猛烈な勢いで計算していく。」

**ステップ6：Canvasへの最終描画**
「計算が終わると、完成した2Dのイメージが生成される。レンダラーは、そのイメージをHTMLの`<canvas>`要素に転送し、我々の目にようやく絵として映る、というわけさ。」

**カエル君:** 「はぁ〜〜…。僕たちが書いたたった一行の裏で、そんな壮大なリレーが行われていたなんて…。感動で言葉も出ないケロ…。」

### パフォーマンスと開発者が知るべきこと

**カエル君:** 「でも先生、これだけ大変な処理をしているのに、ブラウザでスイスイ動くのはなぜなんだケロ？ パフォーマンスは大丈夫なんだケロか？」

**三郎先生:** 「良い質問だ。WebGLとGPUのおかげで、この処理は驚くほど速い。だが、無敵ではない。開発者がパフォーマンスを意識することは非常に重要だ。そして、ボトルネック（処理が詰まる場所）は、多くの場合GPUの計算速度そのものではなく、**ステップ4のドローコールの回数**なんだ。」

**カエル君:** 「ドローコール！？ GPUへの命令回数だケロ？」

**三郎先生:** 「その通り。CPUからGPUへの命令発行は、実は結構コストが高い処理なんだ。司令官が兵士一人一人に個別の命令を出すのを想像してごらん。兵士が1万人いたら、命令だけで日が暮れてしまうだろう？ GPUという兵士は超優秀でも、司令官の命令が多すぎると、全体として遅くなってしまうんだ。」

**カエル君:** 「なるほど！ じゃあ、開発者はどうすればいいんだケロ？」

**三郎先生:** 「司令官（レンダラー）が賢く働けるように、我々が心がけるべきポイントがいくつかある。」

1.  **ドローコールを減らす:** これが最も重要だ。例えば、1000個の同じ形のオブジェクトを描くのに1000回命令するのではなく、「この形のオブジェクトを、これらの1000個の場所に一気に描け！」と1回で命令する（**InstancedMesh**）。あるいは、複数のオブジェクトをプログラム上で一つに合体させてしまう（**ジオメトリのマージ**）。これが、司令官への最高の思いやりだ。

2.  **ポリゴン数とテクスチャサイズを管理する:** 3Dの基本だね。不必要に細かすぎるモデルや、巨大すぎる画像は、GPUに送るデータ量を増やし、パフォーマンスを低下させる。

3.  **ライトとシャドウは高コストだと知る:** 特に、動くオブジェクトが落とす動的な影の計算は、レンダラーの仕事の中でもトップクラスに負荷が高い。本当に必要か、よく考えることが大事だ。

4.  **レンダラーのオプションを理解する:** `new THREE.WebGLRenderer({ antialias: true })` のように、アンチエイリアス（ギザギザを滑らかにする処理）を有効にすると綺麗になるが、少し負荷が上がる。また、`renderer.setPixelRatio(window.devicePixelRatio)` を設定すると、高解像度ディスプレイでくっきり表示されるが、その分描画するピクセル数が増える。これらはトレードオフの関係にあることを知っておこう。

**カエル君:** 「うおおお…！ レンダラーを使いこなすことは、司令官を上手に動かすことなんだケロね！ パフォーマンスの謎まで解けて、これでThree.jsの全てが繋がった気がするんだケロ！ 先生、本当にありがとうケロ！ ピョンピョンピョーーーン！」

**三郎先生:** 「よくぞここまでついてきた、カエル君。君はもう立派な3D世界の探求者だ。だが、本当の冒険はここから始まる。今日学んだ知識を武器に、君だけの世界を創造していくんだ。いつでも応援しているよ。」

---
*（第8話へつづく）*
